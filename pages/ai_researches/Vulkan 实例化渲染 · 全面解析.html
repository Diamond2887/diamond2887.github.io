<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vulkan å®ä¾‹åŒ–æ¸²æŸ“ Â· å…¨é¢è§£æ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            background: #f0f3f8;
            font-family: 'Segoe UI', Roboto, system-ui, -apple-system, sans-serif;
            line-height: 1.6;
            padding: 2rem 1rem;
            color: #1e2b3c;
        }
        .document-container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255,255,255,0.7);
            backdrop-filter: blur(2px);
            border-radius: 2rem;
            box-shadow: 0 20px 40px -10px rgba(0,20,40,0.25);
            padding: 2.5rem 2rem;
            border: 1px solid rgba(255,255,255,0.5);
        }
        h1 {
            font-size: 2.8rem;
            font-weight: 600;
            background: linear-gradient(145deg, #2a4b7c, #4b7bb8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.25rem;
            letter-spacing: -0.02em;
            border-left: 8px solid #2a4b7c;
            padding-left: 1.5rem;
        }
        .subhead {
            font-size: 1.1rem;
            color: #4a5f73;
            margin-bottom: 2.5rem;
            margin-top: 0.2rem;
            padding-left: 2.2rem;
            font-style: italic;
        }
        /* ç« èŠ‚æŠ˜å å¡ç‰‡ */
        details {
            background: white;
            border-radius: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid #d9e2ef;
            box-shadow: 0 6px 14px rgba(0,10,30,0.05);
            transition: all 0.2s;
        }
        details[open] {
            box-shadow: 0 12px 28px rgba(20,60,120,0.15);
        }
        summary {
            background: #f9fcff;
            padding: 1.2rem 2rem;
            border-radius: 1.5rem;
            font-weight: 600;
            font-size: 1.6rem;
            color: #113955;
            cursor: pointer;
            list-style: none;
            position: relative;
            border-bottom: 2px solid transparent;
            transition: background 0.2s;
        }
        summary::-webkit-details-marker {
            display: none;
        }
        summary::before {
            content: 'ğŸ“Œ';
            margin-right: 1rem;
            font-size: 1.5rem;
            opacity: 0.8;
        }
        details[open] summary {
            background: #e5effa;
            border-bottom: 2px solid #2a4b7c;
            border-radius: 1.5rem 1.5rem 0 0;
        }
        details[open] summary::before {
            content: 'ğŸ”½';
        }
        .section-content {
            padding: 1.8rem 2.5rem 2.5rem;
        }
        h2 {
            font-size: 1.8rem;
            font-weight: 500;
            margin: 1.8rem 0 1rem;
            color: #1f3a57;
            border-bottom: 2px dashed #b6cbe0;
            padding-bottom: 0.3rem;
        }
        h3 {
            font-size: 1.3rem;
            font-weight: 600;
            margin: 1.8rem 0 0.8rem;
            color: #2b4b6f;
            display: inline-block;
            background: linear-gradient(to right, transparent 0%, #d4e2f5 100%);
            padding: 0.2rem 1rem 0.2rem 0.5rem;
            border-radius: 0 20px 20px 0;
        }
        p, li {
            color: #2b3e55;
            margin-bottom: 0.9rem;
        }
        ul, ol {
            margin-left: 1.8rem;
            margin-bottom: 1.2rem;
        }
        li {
            margin-bottom: 0.3rem;
        }
        .code-block {
            background: #1e2b3c;
            border-radius: 1rem;
            margin: 1.5rem 0;
            box-shadow: inset 0 0 0 1px #30445a, 0 8px 16px rgba(0,0,0,0.1);
        }
        pre {
            background: transparent;
            padding: 1.2rem 1.6rem;
            overflow-x: auto;
            font-family: 'JetBrains Mono', 'Fira Code', 'Cascadia Code', monospace;
            font-size: 0.85rem;
            line-height: 1.5;
            color: #e3eaf1;
            tab-size: 4;
            white-space: pre-wrap;
            word-break: break-word;
        }
        code {
            font-family: inherit;
            background: transparent;
            color: inherit;
        }
        /* è¡Œå†…ä»£ç  */
        p code, li code {
            background: #dde6f0;
            color: #1c3d5e;
            padding: 0.2rem 0.4rem;
            border-radius: 0.4rem;
            font-size: 0.9em;
            font-weight: 500;
            border: 1px solid #b2c9de;
        }
        .badge {
            background: #1f4973;
            color: white;
            font-size: 0.75rem;
            font-weight: 500;
            padding: 0.2rem 0.7rem;
            border-radius: 30px;
            display: inline-block;
            margin-right: 0.5rem;
        }
        .note {
            background: #ebf3fa;
            padding: 1.2rem 2rem;
            border-radius: 1rem;
            border-left: 8px solid #1f4973;
            margin: 1.5rem 0;
            font-style: normal;
            box-shadow: inset 0 0 0 1px #fff;
        }
        hr {
            border: none;
            border-top: 2px dotted #a7c0da;
            margin: 2rem 0;
        }
        .footer-note {
            margin-top: 3rem;
            text-align: center;
            color: #5c6f87;
            font-size: 0.9rem;
            background: #e9f0f9;
            padding: 1rem;
            border-radius: 3rem;
        }
    </style>
</head>
<body>
<div class="document-container">
    <h1>âš¡ Vulkan å®ä¾‹åŒ–æ¸²æŸ“ Â· æŠ€æœ¯å…¨é¢è§£æ</h1>
    <div class="subhead">ä»åŸç†åˆ°æœ€ä½³å®è·µ Â· å«ä»£ç ç²¾è¦ Â· å®Œå…¨é™æ€å¯æŠ˜å </div>

    <!-- ç« èŠ‚1ï¼šåŸºç¡€æ¦‚å¿µä¸æŠ€æœ¯åŸç† -->
    <details open>
        <summary>1. åŸºç¡€æ¦‚å¿µä¸æŠ€æœ¯åŸç†</summary>
        <div class="section-content">
            <h2>1.1 å®ä¾‹åŒ–æ¸²æŸ“æ¦‚è¿°</h2>
            <p>å®ä¾‹åŒ–æ¸²æŸ“æ˜¯ä¸€ç§é€šè¿‡è°ƒç”¨ç‰¹æ®Šæ¸²æŸ“æ¥å£ï¼Œç”±GPUå®Œæˆçš„æ‰¹å¤„ç†æŠ€æœ¯ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯åªä¸Šä¼ ä¸€æ¬¡æ¨¡å‹çš„é¡¶ç‚¹æ•°æ®ï¼Œé€šè¿‡ä¸€ä¸ªç»˜åˆ¶è°ƒç”¨ï¼Œè®©GPUåŒæ—¶æ¸²æŸ“å‡ºå¤šä¸ªç›¸åŒçš„æ¨¡å‹ã€‚ä¸ä¼ ç»Ÿæ¸²æŸ“æ–¹å¼ç›¸æ¯”ï¼Œå®ä¾‹åŒ–æ¸²æŸ“åœ¨è°ƒç”¨æ¸²æŸ“å‘½ä»¤æ—¶éœ€è¦å‘ŠçŸ¥GPUè¿™æ¬¡æ¸²æŸ“çš„æ¬¡æ•°ï¼ŒGPUæ¥åˆ°å‘½ä»¤åï¼Œä¼šè¿ç»­ç»˜åˆ¶å¤šä¸ªç‰©ä½“åˆ°å±å¹•ä¸Šï¼Œæ•ˆç‡è¿œé«˜äºè¿ç»­è°ƒç”¨å¤šæ¬¡ä¼ ç»Ÿæ¸²æŸ“å‘½ä»¤ã€‚</p>
            <p>åœ¨ä¼ ç»Ÿæ¸²æŸ“ä¸­ï¼Œé¡¶ç‚¹å±æ€§ï¼ˆæ¯”å¦‚é¡¶ç‚¹ä½ç½®ã€æ³•çº¿ã€é¢œè‰²ï¼‰æ˜¯"é€é¡¶ç‚¹"çš„â€”â€”æ¯ä¸ªé¡¶ç‚¹å¯¹åº”ä¸€ç»„å±æ€§æ•°æ®ã€‚è€Œå®ä¾‹åŒ–é¡¶ç‚¹å±æ€§æ˜¯"é€å®ä¾‹"çš„â€”â€”æ¯ä¸ªå®ä¾‹å¯¹åº”ä¸€ç»„å±æ€§æ•°æ®ï¼ŒåŒä¸€å®ä¾‹çš„æ‰€æœ‰é¡¶ç‚¹å…±äº«è¿™ç»„æ•°æ®ã€‚è¿™ç§è®¾è®¡ä½¿å¾—GPUèƒ½å¤Ÿæ›´é«˜æ•ˆåœ°å¤„ç†å¤§è§„æ¨¡ç›¸ä¼¼å¯¹è±¡çš„æ¸²æŸ“ä»»åŠ¡ã€‚</p>

            <h2>1.2 Vulkanå®ä¾‹åŒ–æ¸²æŸ“çš„æ ¸å¿ƒæ¦‚å¿µ</h2>
            <p><span class="badge">å®ä¾‹ID</span> åœ¨Vulkanä¸­ï¼Œé¡¶ç‚¹ç€è‰²å™¨ä½¿ç”¨å†…ç½®å˜é‡<code>gl_InstanceIndex</code>æ¥è¡¨ç¤ºå½“å‰å®ä¾‹çš„ç´¢å¼•ï¼Œè¿™ä¸ªå˜é‡ä»0å¼€å§‹é€’å¢ï¼Œç”¨äºåŒºåˆ†ä¸åŒçš„å®ä¾‹ã€‚éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼ŒVulkanä½¿ç”¨<code>gl_InstanceIndex</code>è€ŒéOpenGLä¸­çš„<code>gl_InstanceID</code>ã€‚</p>
            <p><span class="badge">å®ä¾‹æ•°æ®</span> æ˜¯æ¯ä¸ªå®ä¾‹ç‹¬æœ‰çš„å±æ€§æ•°æ®é›†åˆã€‚è¿™äº›æ•°æ®é€šå¸¸åŒ…æ‹¬å˜æ¢çŸ©é˜µã€é¢œè‰²ã€çº¹ç†ç´¢å¼•ã€æè´¨å‚æ•°ç­‰ã€‚å®ä¾‹æ•°æ®å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼ä¼ é€’ç»™ç€è‰²å™¨ï¼ŒåŒ…æ‹¬é¡¶ç‚¹ç¼“å†²åŒºã€ç»Ÿä¸€ç¼“å†²åŒºæ•°ç»„ã€æ¨é€å¸¸é‡ç­‰ã€‚</p>
            <p><span class="badge">å®ä¾‹åŒ–ç»˜åˆ¶è°ƒç”¨</span> é€šè¿‡Vulkançš„<code>vkCmdDraw</code>æˆ–<code>vkCmdDrawIndexed</code>å‡½æ•°å®ç°ï¼Œè¿™ä¸¤ä¸ªå‡½æ•°éƒ½åŒ…å«<code>instanceCount</code>å‚æ•°æ¥æŒ‡å®šè¦æ¸²æŸ“çš„å®ä¾‹æ•°é‡ã€‚å½“ä¸ä½¿ç”¨å®ä¾‹åŒ–æ—¶ï¼Œ<code>instanceCount</code>åº”è¯¥è®¾ç½®ä¸º1è€Œä¸æ˜¯0ã€‚</p>

            <h2>1.3 ä¸ä¼ ç»Ÿæ¸²æŸ“æ–¹å¼çš„åŒºåˆ«</h2>
            <ul>
                <li><strong>å‡å°‘CPU-GPUé€šä¿¡</strong>ï¼šé€šè¿‡å•ä¸ªç»˜åˆ¶å‘½ä»¤æ›¿ä»£å¤šä¸ªç»˜åˆ¶å‘½ä»¤ï¼Œæ˜¾è‘—å‡å°‘äº†CPUä¸GPUä¹‹é—´çš„æ•°æ®ä¼ è¾“ã€‚</li>
                <li><strong>é™ä½é©±åŠ¨å¼€é”€</strong>ï¼šå‡å°‘äº†çŠ¶æ€è®¾ç½®çš„æ¬¡æ•°ï¼Œé™ä½äº†é©±åŠ¨ç¨‹åºçš„å¤„ç†å¼€é”€ã€‚</li>
                <li><strong>æé«˜ç¼“å­˜åˆ©ç”¨ç‡</strong>ï¼šå…±äº«é¡¶ç‚¹æ•°æ®èƒ½å¤Ÿæ›´å¥½åœ°åˆ©ç”¨GPUçš„ç¼“å­˜æœºåˆ¶ï¼Œæé«˜æ•°æ®è®¿é—®æ•ˆç‡ã€‚</li>
                <li><strong>å¤šçº¿ç¨‹æ”¯æŒ</strong>ï¼šVulkançš„å¤šçº¿ç¨‹æ¶æ„ä½¿å¾—å®ä¾‹åŒ–æ¸²æŸ“èƒ½å¤Ÿæ›´å¥½åœ°åˆ©ç”¨ç°ä»£å¤šæ ¸CPUçš„è®¡ç®—èƒ½åŠ›ã€‚</li>
            </ul>

            <h2>1.4 æ ¸å¿ƒä¼˜åŠ¿ä¸åº”ç”¨åœºæ™¯</h2>
            <p><strong>æ€§èƒ½ä¼˜åŠ¿</strong> æ˜¯æœ€çªå‡ºçš„ç‰¹ç‚¹ï¼Œå¯æ˜¾è‘—é™ä½ç»˜åˆ¶è°ƒç”¨æ•°é‡ã€‚<strong>å†…å­˜æ•ˆç‡</strong> é€šè¿‡å…±äº«é¡¶ç‚¹æ•°æ®å¤§å¹…å‡å°‘å†…å­˜å ç”¨ã€‚<strong>æ¸²æŸ“çµæ´»æ€§</strong> ä½“ç°åœ¨æ¯ä¸ªå®ä¾‹å¯ä»¥å…·æœ‰ä¸åŒçš„å±æ€§ã€‚</p>
            <p>ä¸»è¦åº”ç”¨åœºæ™¯ï¼šå¤§è§„æ¨¡æ¤è¢«æ¸²æŸ“ã€ç²’å­ç³»ç»Ÿã€äººç¾¤æ¨¡æ‹Ÿã€å»ºç­‘å’ŒåŸå¸‚æ™¯è§‚ã€ç”¨æˆ·ç•Œé¢ç­‰ã€‚</p>
        </div>
    </details>

    <!-- ç« èŠ‚2ï¼šå®ç°æ­¥éª¤è¯¦è§£ -->
    <details open>
        <summary>2. å®ç°æ­¥éª¤è¯¦è§£</summary>
        <div class="section-content">
            <h2>2.1 ç¯å¢ƒå‡†å¤‡ä¸åŸºç¡€è®¾ç½®</h2>
            <p>ç¡®ä¿æ˜¾å¡é©±åŠ¨æ”¯æŒVulkan 1.0+ï¼Œå®‰è£…Vulkan SDKã€‚åˆ›å»ºVulkanå®ä¾‹å’Œé€»è¾‘è®¾å¤‡ï¼Œå¯ç”¨éªŒè¯å±‚ï¼Œè®¾ç½®è¡¨é¢ä¸äº¤æ¢é“¾ã€‚</p>

            <h2>2.2 åˆ›å»ºå®ä¾‹æ•°æ®ç»“æ„</h2>
            <p>å®šä¹‰æ¯ä¸ªå®ä¾‹çš„å±æ€§ï¼Œæ³¨æ„å†…å­˜å¯¹é½ï¼š</p>
            <div class="code-block"><pre><code>struct InstanceData {
    glm::vec3 position;   // ä½ç½®
    glm::vec3 rotation;   // æ—‹è½¬
    glm::vec3 scale;      // ç¼©æ”¾
    glm::vec4 color;      // é¢œè‰²
    int textureIndex;     // çº¹ç†ç´¢å¼•
    // å…¶ä»–å®ä¾‹ç‰¹æœ‰å±æ€§...
};</code></pre></div>
            <p>åˆå§‹åŒ–ç¤ºä¾‹ï¼ˆç½‘æ ¼å¸ƒå±€ï¼‰ï¼š</p>
            <div class="code-block"><pre><code>const int instanceCount = 100;
std::vector&lt;InstanceData&gt; instanceData(instanceCount);
for (int i = 0; i &lt; instanceCount; i++) {
    int cols = static_cast&lt;int&gt;(std::ceil(std::sqrt(instanceCount)));
    int x = i % cols, y = i / cols;
    instanceData[i].position = glm::vec3(x * 3.0f, 0.0f, y * 3.0f);
    instanceData[i].rotation = glm::vec3(0.0f, glm::radians(45.0f * i), 0.0f);
    instanceData[i].scale = glm::vec3(1.0f);
    instanceData[i].color = glm::vec4(1.0f, (float)i/instanceCount, 0.0f, 1.0f);
}</code></pre></div>

            <h2>2.3 é…ç½®é¡¶ç‚¹è¾“å…¥å’Œå®ä¾‹ç¼“å†²åŒº</h2>
            <p>åˆ›å»ºå®ä¾‹ç¼“å†²åŒºï¼ˆè®¾å¤‡æœ¬åœ°ï¼‰ï¼Œä½¿ç”¨æš‚å­˜Bufferå¡«å……æ•°æ®ï¼š</p>
            <div class="code-block"><pre><code>VkBuffer instanceBuffer;
VkDeviceMemory instanceBufferMemory;
VkBufferCreateInfo bufferInfo{};
bufferInfo.sType = VK_STRUCTURE_TYPE_BUFFER_CREATE_INFO;
bufferInfo.size = instanceData.size() * sizeof(InstanceData);
bufferInfo.usage = VK_BUFFER_USAGE_VERTEX_BUFFER_BIT;
vkCreateBuffer(device, &amp;bufferInfo, nullptr, &amp;instanceBuffer);</code></pre></div>
            <p>ç»‘å®šæè¿°ï¼š<code>VK_VERTEX_INPUT_RATE_INSTANCE</code></p>
            <div class="code-block"><pre><code>// å®ä¾‹æ•°æ®ç»‘å®šï¼ˆç»‘å®šç‚¹1ï¼ŒæŒ‰å®ä¾‹æ›´æ–°ï¼‰
VkVertexInputBindingDescription bindingDesc{
    1, sizeof(InstanceData), VK_VERTEX_INPUT_RATE_INSTANCE
};
// å±æ€§ï¼šä½ç½®ã€æ—‹è½¬ã€ç¼©æ”¾ã€é¢œè‰²ç­‰
VkVertexInputAttributeDescription attrDesc[] = {
    {3, 1, VK_FORMAT_R32G32B32_SFLOAT, offsetof(InstanceData, position)},
    {4, 1, VK_FORMAT_R32G32B32_SFLOAT, offsetof(InstanceData, rotation)},
    {5, 1, VK_FORMAT_R32G32B32_SFLOAT, offsetof(InstanceData, scale)},
    {6, 1, VK_FORMAT_R32G32B32A32_SFLOAT, offsetof(InstanceData, color)}
};</code></pre></div>

            <h2>2.4 ç¼–å†™å®ä¾‹åŒ–ç€è‰²å™¨</h2>
            <p>é¡¶ç‚¹ç€è‰²å™¨ä½¿ç”¨<code>gl_InstanceIndex</code>å¹¶è¯»å–å®ä¾‹å±æ€§ï¼š</p>
            <div class="code-block"><pre><code>#version 450
layout(location = 0) in vec3 inPosition;
layout(location = 1) in vec3 inNormal;
layout(location = 3) in vec3 instancePosition;   // å®ä¾‹æ•°æ®
layout(location = 4) in vec3 instanceRotation;
layout(location = 5) in vec3 instanceScale;
out vec3 fragNormal;

uniform UBO { mat4 projection; mat4 view; } ubo;

void main() {
    mat4 model = mat4(1.0);
    model = translate(model, instancePosition);
    model = rotate(model, instanceRotation.x, vec3(1,0,0));
    model = rotate(model, instanceRotation.y, vec3(0,1,0));
    model = scale(model, instanceScale);
    gl_Position = ubo.projection * ubo.view * model * vec4(inPosition, 1.0);
    fragNormal = mat3(transpose(inverse(model))) * inNormal;
}</code></pre></div>
            <p>ä¹Ÿå¯ä»¥ä½¿ç”¨ç»Ÿä¸€ç¼“å†²åŒºæ•°ç»„ï¼š<code>instances.positions[gl_InstanceIndex]</code></p>

            <h2>2.5 æ¸²æŸ“æµç¨‹é›†æˆ</h2>
            <p>åˆ›å»ºç®¡çº¿æ—¶æŒ‡å®š<code>pVertexInputState</code>ï¼Œå½•åˆ¶å‘½ä»¤æ—¶åˆ†åˆ«ç»‘å®šé¡¶ç‚¹ç¼“å†²åŒºå’Œå®ä¾‹ç¼“å†²åŒºï¼š</p>
            <div class="code-block"><pre><code>VkDeviceSize offsets[1] = {0};
vkCmdBindVertexBuffers(cmdBuf, 0, 1, &amp;vertexBuffer, offsets);    // é¡¶ç‚¹
vkCmdBindVertexBuffers(cmdBuf, 1, 1, &amp;instanceBuffer, offsets); // å®ä¾‹
vkCmdBindIndexBuffer(cmdBuf, indexBuffer, 0, VK_INDEX_TYPE_UINT32);
vkCmdDrawIndexed(cmdBuf, indexCount, instanceCount, 0, 0, 0);</code></pre></div>

            <h2>2.6 å¤šå®ä¾‹åœºæ™¯ç®¡ç†</h2>
            <p>ä½¿ç”¨æ‰¹æ¬¡<code>InstanceBatch</code>ç»„ç»‡ç›¸åŒæè´¨/ç½‘æ ¼çš„å®ä¾‹ï¼Œå¹¶æ‰§è¡Œè§†é”¥ä½“å‰”é™¤ï¼š</p>
            <div class="code-block"><pre><code>struct InstanceBatch {
    uint32_t firstInstance, instanceCount, materialID, meshID;
};
// å¯¹æ¯ä¸ªå®ä¾‹è®¡ç®—åŒ…å›´çƒä¸è§†é”¥ä½“ç›¸äº¤æµ‹è¯•
for (size_t i = 0; i &lt; instances.size(); i++) {
    glm::vec3 center = instances[i].position;
    float radius = instances[i].scale.x * 0.5f;
    bool visible = true;
    for (int p = 0; p &lt; 6; p++) {
        if (glm::dot(center, frustumPlanes[p].normal) + frustumPlanes[p].distance &lt; -radius)
            visible = false;
    }
}</code></pre></div>
        </div>
    </details>

    <!-- ç« èŠ‚3ï¼šæ€§èƒ½ä¼˜åŒ–æŠ€å·§ -->
    <details open>
        <summary>3. æ€§èƒ½ä¼˜åŒ–æŠ€å·§</summary>
        <div class="section-content">
            <h2>3.1 å®ä¾‹æ•°æ®ç»„ç»‡ä¼˜åŒ–</h2>
            <p>æ˜¾å¼å¯¹é½è‡³256å­—èŠ‚ï¼š</p>
            <div class="code-block"><pre><code>struct alignas(256) InstanceData {
    glm::vec3 position;
    glm::vec3 rotation;
    glm::vec3 scale;
    glm::vec4 color;
    int textureIndex;
    int padding[3];   // è¡¥é½
};</code></pre></div>
            <p><strong>å®ä¾‹æ‰¹æ¬¡åŒ–</strong>ï¼šå°†ç›¸åŒæè´¨/ç½‘æ ¼çš„å®ä¾‹è¿ç»­æ¸²æŸ“ï¼Œå‡å°‘çŠ¶æ€åˆ‡æ¢ã€‚</p>

            <h2>3.2 å†…å­˜ç®¡ç†ä¸ç»‘å®šä¼˜åŒ–</h2>
            <p>ä½¿ç”¨è®¾å¤‡æœ¬åœ°å†…å­˜å­˜å‚¨é™æ€å®ä¾‹æ•°æ®ï¼›åŠ¨æ€æ•°æ®ä½¿ç”¨ä¸»æœºå¯è§å†…å­˜ã€‚å¯¹äºé¢‘ç¹æ›´æ–°çš„æ•°æ®ï¼Œå¯ä½¿ç”¨<code>VK_DESCRIPTOR_TYPE_UNIFORM_BUFFER_DYNAMIC</code>å¹¶æŒ‡å®šåŠ¨æ€åç§»ã€‚</p>
            <div class="code-block"><pre><code>// åˆ›å»ºç»Ÿä¸€ç¼“å†²åŒºæ•°ç»„å­˜å‚¨æ‰€æœ‰å®ä¾‹çŸ©é˜µ
VkBuffer instanceMatricesBuffer;
createBuffer(maxInstances * sizeof(glm::mat4),
    VK_BUFFER_USAGE_UNIFORM_BUFFER_BIT,
    VK_MEMORY_PROPERTY_DEVICE_LOCAL_BIT, ...);</code></pre></div>

            <h2>3.3 æ¸²æŸ“çŠ¶æ€ä¼˜åŒ–</h2>
            <p>ä½¿ç”¨ç®¡çº¿ç¼“å­˜(Pipeline Cache)åŠ é€Ÿåˆ›å»ºï¼ŒæŒ‰æ·±åº¦/æè´¨æ’åºï¼Œåˆå¹¶æ¸²æŸ“é€šé“ã€‚</p>
            <div class="code-block"><pre><code>VkPipelineCacheCreateInfo cacheInfo{};
cacheInfo.sType = VK_STRUCTURE_TYPE_PIPELINE_CACHE_CREATE_INFO;
vkCreatePipelineCache(device, &amp;cacheInfo, nullptr, &amp;pipelineCache);</code></pre></div>

            <h2>3.4 é«˜çº§ä¼˜åŒ–æŠ€æœ¯</h2>
            <p><strong>é—´æ¥ç»˜åˆ¶(Indirect Drawing)</strong>ï¼šä»GPUç¼“å†²åŒºè¯»å–ç»˜åˆ¶å‘½ä»¤ã€‚</p>
            <div class="code-block"><pre><code>VkDrawIndexedIndirectCommand cmd{};
cmd.indexCount = indexCount;
cmd.instanceCount = 1;
cmd.firstInstance = instanceIdx;
// å¡«å……indirectBuffer
vkCmdDrawIndexedIndirect(cmdBuf, indirectBuffer, offset, drawCount, stride);</code></pre></div>
            <p><strong>å¤šçº¿ç¨‹å½•åˆ¶</strong>ï¼šåŒæ—¶è®°å½•å¤šä¸ªå‘½ä»¤ç¼“å†²åŒºï¼Œæœ€åæäº¤ã€‚</p>
            <div class="code-block"><pre><code>std::vector&lt;std::thread&gt; threads;
for (int i = 0; i &lt; numThreads; i++) {
    threads.emplace_back([&amp;, i]() {
        vkBeginCommandBuffer(cmdBufs[i], ...);
        // å½•åˆ¶æ‰¹æ¬¡
        vkEndCommandBuffer(cmdBufs[i]);
    });
}</code></pre></div>
        </div>
    </details>

    <!-- ç« èŠ‚4ï¼šè¡Œä¸šæœ€ä½³å®è·µ -->
    <details open>
        <summary>4. è¡Œä¸šæœ€ä½³å®è·µ</summary>
        <div class="section-content">
            <h2>4.1 ä¸»æµæ¸¸æˆå¼•æ“å®ç°æ¡ˆä¾‹</h2>
            <p><strong>Unity</strong>ï¼šè‡ªåŠ¨æ‰¹å¤„ç†ã€MaterialPropertyBlockã€å…‰ç…§æ¢é’ˆæ”¯æŒã€‚<br>
            <strong>Unreal Engine</strong>ï¼šNiagaraç²’å­ç³»ç»Ÿã€Naniteã€æ¤è¢«ç³»ç»Ÿå¤§é‡ä½¿ç”¨å®ä¾‹åŒ–ã€‚<br>
            <strong>ã€Šèµ›åšæœ‹å…‹2077ã€‹ã€ŠåŸç¥ã€‹ã€Šå ¡å’ä¹‹å¤œã€‹</strong>å‡æ·±åº¦ä¼˜åŒ–Vulkanå®ä¾‹åŒ–ï¼Œå®ç°è¶…å¤§è§„æ¨¡å¯¹è±¡æ¸²æŸ“ã€‚</p>

            <h2>4.2 ç‰¹å®šé¢†åŸŸåº”ç”¨æ¡ˆä¾‹</h2>
            <ul>
                <li><strong>å»ºç­‘å¯è§†åŒ–/CAD</strong>ï¼šAutoCADã€Blenderè§†å£ä½¿ç”¨å®ä¾‹åŒ–åŠ é€Ÿã€‚</li>
                <li><strong>å·¥ä¸šä»¿çœŸ/è™šæ‹Ÿè£…é…</strong>ï¼šAMBF-Vulkanè·å¾—6.1~8.5å€é€Ÿåº¦æå‡ã€‚</li>
                <li><strong>æ±½è½¦ä¸äº¤é€šä»¿çœŸ</strong>ï¼šè½¦è½½IVIã€è‡ªåŠ¨é©¾é©¶åœºæ™¯ã€HUDå…ƒç´ å®ä¾‹åŒ–ã€‚</li>
            </ul>

            <h2>4.3 æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ</h2>
            <ul>
                <li><strong>æœ€å°åŒ–çŠ¶æ€å˜åŒ–</strong>ï¼šåˆ†ç»„æ¸²æŸ“ï¼Œé¿å…é¢‘ç¹ç»‘å®šã€‚</li>
                <li><strong>æ·±åº¦æ’åº</strong>ï¼šå…ˆæ¸²æŸ“ä¸é€æ˜ç‰©ä½“ï¼Œä»å‰åˆ°åï¼›é€æ˜ç‰©ä½“ä»ååˆ°å‰ã€‚</li>
                <li><strong>åŠ¨æ€ç¼“å†²åŒº</strong>ï¼šä½¿ç”¨<code>VK_DESCRIPTOR_TYPE_UNIFORM_BUFFER_DYNAMIC</code>å‡å°‘æè¿°ç¬¦åˆ‡æ¢ã€‚</li>
                <li><strong>å¤šçº¿ç¨‹æ„å»ºå‘½ä»¤ç¼“å†²</strong>ï¼šå……åˆ†åˆ©ç”¨å¤šæ ¸CPUã€‚</li>
            </ul>

            <h2>4.4 å¼€å‘è°ƒè¯•å»ºè®®</h2>
            <p>å¯ç”¨å®Œæ•´KhronoséªŒè¯å±‚ï¼Œä½¿ç”¨RenderDocã€NVIDIA Nsightç­‰å·¥å…·åˆ†æã€‚ç€è‰²å™¨è°ƒè¯•å¯è¾“å‡º<code>gl_InstanceIndex</code>åˆ°é¢œè‰²ã€‚å»ºç«‹åŸºå‡†æµ‹è¯•ä¸å›å½’æµ‹è¯•ã€‚</p>
        </div>
    </details>

    <!-- ç« èŠ‚5ï¼šæ€»ç»“ä¸å±•æœ› -->
    <details open>
        <summary>5. æ€»ç»“ä¸å±•æœ›</summary>
        <div class="section-content">
            <p>Vulkanå®ä¾‹åŒ–æ¸²æŸ“é€šè¿‡åˆå¹¶ç»˜åˆ¶è°ƒç”¨ï¼Œä»æ ¹æœ¬ä¸Šå‡å°‘äº†CPU-GPUé€šä¿¡ä¸é©±åŠ¨å¼€é”€ã€‚åˆç†åˆ©ç”¨å®ä¾‹IDã€å®ä¾‹æ•°æ®æ‰¹æ¬¡ã€é—´æ¥ç»˜åˆ¶ã€å¤šçº¿ç¨‹ç­‰æŠ€æœ¯ï¼Œå¯ä»¥è½»æ¾æ¸²æŸ“æ•°ç™¾ä¸‡å®ä¾‹ã€‚æœªæ¥ç¡¬ä»¶å°†æ”¯æŒæ›´å¤§çš„å®ä¾‹æ•°é‡ï¼Œè½¯ä»¶ç”Ÿæ€ï¼ˆUnity/UEï¼‰ç»§ç»­å¼ºåŒ–å®ä¾‹åŒ–ï¼Œå¹¶ä¸å…‰çº¿è¿½è¸ªã€æœºå™¨å­¦ä¹ èåˆï¼Œå®ç°æ›´æ™ºèƒ½çš„GPUé©±åŠ¨æ¸²æŸ“ã€‚å¼€å‘è€…æŒæ¡å®ä¾‹åŒ–æŠ€æœ¯æ˜¯æ„å»ºé«˜æ€§èƒ½å›¾å½¢åº”ç”¨çš„åŸºçŸ³ã€‚</p>
            <hr>
            <div class="note">
                <p>âœ¨ æœ¬é¡µé¢å®Œå…¨é™æ€ï¼Œæ— å¤–éƒ¨é“¾æ¥/JSï¼Œæ‰€æœ‰ä»£ç å‡å·²è½¬ä¹‰ã€‚æŠ˜å ç« èŠ‚é»˜è®¤å±•å¼€ï¼Œä¾¿äºé˜…è¯»ã€‚å…³é”®ä»£ç ä¿æŒåŸæ±åŸå‘³ï¼Œå¹¶çªå‡ºæ˜¾ç¤ºã€‚</p>
            </div>
        </div>
    </details>

    <!-- é¢å¤–ï¼šå†…å®¹ç”±AIç”Ÿæˆæ ‡è¯† -->
    <div class="footer-note">
        ğŸ“„ å†…å®¹åŸºäºã€ŠVulkanå®ä¾‹åŒ–æ¸²æŸ“æŠ€æœ¯å…¨é¢è§£æã€‹æ–‡æœ¬ Â· ç”± AI ç”Ÿæˆ Â· å‘ˆç°ä¸ºå±‚çº§æŠ˜å å¼æŒ‡å—
    </div>
</div>
</body>
</html>