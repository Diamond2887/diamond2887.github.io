<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>阴影映射技术（Shadow Mapping）详解</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #0f172a;
            color: #e2e8f0;
            line-height: 1.6;
            padding: 20px;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(30, 58, 138, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(124, 58, 237, 0.1) 0%, transparent 20%);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: rgba(15, 23, 42, 0.8);
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            border: 1px solid rgba(100, 116, 139, 0.2);
        }
        
        header {
            background: linear-gradient(135deg, #1e3a8a 0%, #4338ca 100%);
            padding: 30px 40px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #60a5fa, #a78bfa);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .subtitle {
            font-size: 1.1rem;
            color: #cbd5e1;
            margin-bottom: 20px;
        }
        
        .meta-info {
            display: flex;
            gap: 20px;
            font-size: 0.9rem;
            color: #94a3b8;
        }
        
        .meta-info span {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .meta-info svg {
            width: 16px;
            height: 16px;
            fill: #60a5fa;
        }
        
        .content {
            padding: 30px 40px;
        }
        
        h2 {
            color: #60a5fa;
            margin: 40px 0 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(96, 165, 250, 0.3);
            font-size: 1.8rem;
        }
        
        h3 {
            color: #a78bfa;
            margin: 30px 0 15px;
            font-size: 1.4rem;
        }
        
        h4 {
            color: #38bdf8;
            margin: 25px 0 12px;
            font-size: 1.2rem;
        }
        
        .chapter {
            margin-bottom: 40px;
            background-color: rgba(30, 41, 59, 0.4);
            border-radius: 10px;
            padding: 20px;
            border-left: 4px solid #3b82f6;
        }
        
        .algorithm-box {
            background-color: rgba(15, 23, 42, 0.7);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid rgba(100, 116, 139, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .algorithm-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(to bottom, #60a5fa, #a78bfa);
        }
        
        .algorithm-title {
            color: #38bdf8;
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .algorithm-title svg {
            width: 20px;
            height: 20px;
            fill: #38bdf8;
        }
        
        .code-block {
            background-color: #0a0e17;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9rem;
            overflow-x: auto;
            border: 1px solid rgba(96, 165, 250, 0.2);
            color: #cbd5e1;
        }
        
        .code-comment {
            color: #6b7280;
        }
        
        .code-keyword {
            color: #60a5fa;
        }
        
        .code-function {
            color: #a78bfa;
        }
        
        .code-string {
            color: #34d399;
        }
        
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background-color: rgba(30, 41, 59, 0.4);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .comparison-table th {
            background-color: #1e3a8a;
            color: #e2e8f0;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }
        
        .comparison-table td {
            padding: 12px 15px;
            border-bottom: 1px solid rgba(100, 116, 139, 0.3);
        }
        
        .comparison-table tr:last-child td {
            border-bottom: none;
        }
        
        .comparison-table tr:nth-child(even) {
            background-color: rgba(15, 23, 42, 0.2);
        }
        
        .parallel {
            color: #60a5fa;
            font-weight: 600;
        }
        
        .point {
            color: #a78bfa;
            font-weight: 600;
        }
        
        .diagram {
            background-color: rgba(30, 41, 59, 0.6);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            border: 1px solid rgba(96, 165, 250, 0.2);
        }
        
        .diagram-title {
            color: #38bdf8;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .diagram-content {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 200px;
            color: #94a3b8;
            font-style: italic;
        }
        
        .diagram-light-source {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: radial-gradient(circle, #fbbf24, #f59e0b);
            display: flex;
            justify-content: center;
            align-items: center;
            color: #0f172a;
            font-weight: bold;
            margin: 0 auto 20px;
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.5);
        }
        
        .diagram-shadow-map {
            width: 150px;
            height: 150px;
            background: linear-gradient(45deg, #1e3a8a, #4338ca);
            margin: 0 auto;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 8px;
            color: #e2e8f0;
            font-weight: bold;
            border: 2px solid #60a5fa;
        }
        
        .optimization-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        
        .optimization-card {
            background-color: rgba(30, 41, 59, 0.6);
            border-radius: 8px;
            padding: 20px;
            border-top: 4px solid #10b981;
            transition: transform 0.3s;
        }
        
        .optimization-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .optimization-card h4 {
            color: #10b981;
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .optimization-card h4 svg {
            width: 20px;
            height: 20px;
            fill: #10b981;
        }
        
        details {
            margin: 20px 0;
            background-color: rgba(30, 41, 59, 0.4);
            border-radius: 8px;
            overflow: hidden;
        }
        
        summary {
            padding: 18px 20px;
            background-color: rgba(30, 58, 138, 0.3);
            cursor: pointer;
            font-weight: 600;
            color: #60a5fa;
            font-size: 1.1rem;
            border-left: 4px solid #60a5fa;
        }
        
        summary:hover {
            background-color: rgba(30, 58, 138, 0.5);
        }
        
        details[open] summary {
            border-bottom: 1px solid rgba(96, 165, 250, 0.3);
        }
        
        details > div {
            padding: 20px;
        }
        
        footer {
            text-align: center;
            padding: 30px;
            margin-top: 40px;
            border-top: 1px solid rgba(100, 116, 139, 0.3);
            color: #94a3b8;
            font-size: 0.9rem;
        }
        
        .ai-generated {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 5px 10px;
            background-color: rgba(59, 130, 246, 0.2);
            border-radius: 20px;
            margin-top: 10px;
        }
        
        .ai-generated svg {
            width: 16px;
            height: 16px;
            fill: #60a5fa;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            header, .content {
                padding: 20px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .optimization-grid {
                grid-template-columns: 1fr;
            }
            
            .meta-info {
                flex-direction: column;
                gap: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>阴影映射技术（Shadow Mapping）详解</h1>
            <p class="subtitle">计算机图形学中生成实时阴影的核心算法，从基础原理到现代应用全面剖析</p>
            <div class="meta-info">
                <span>
                    <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
                    静态HTML页面 - 无需外部资源
                </span>
                <span>
                    <svg viewBox="0 0 24 24"><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"/></svg>
                    包含完整代码示例
                </span>
                <span>
                    <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-8 14H7v-2h4v2zm0-4H7v-2h4v2zm0-4H7V7h4v2zm6 8h-4v-2h4v2zm0-4h-4v-2h4v2zm0-4h-4V7h4v2z"/></svg>
                    平行光与点光源对比
                </span>
            </div>
        </header>
        
        <div class="content">
            <section class="chapter">
                <h2>一、阴影映射技术原理与相关算法步骤</h2>
                <p>阴影映射技术是计算机图形学中生成实时阴影的核心算法，自1978年由Lance Williams首次提出以来，已成为现代实时渲染引擎的标准技术。</p>
                
                <details>
                    <summary>1.1 核心原理与双阶段渲染机制</summary>
                    <div>
                        <p>阴影映射技术的基本原理基于一个简单而深刻的观察：<strong>当一个点无法从光源视角被看到时，该点就处于阴影中</strong>。</p>
                        <div class="algorithm-box">
                            <div class="algorithm-title">
                                <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/></svg>
                                双阶段渲染机制
                            </div>
                            <ol>
                                <li><strong>阴影生成阶段</strong>：从光源视角渲染场景，生成阴影贴图（Shadow Map）</li>
                                <li><strong>渲染阶段</strong>：从摄像机视角渲染场景，通过深度比较判断像素是否处于阴影中</li>
                            </ol>
                        </div>
                        
                        <div class="diagram">
                            <div class="diagram-title">阴影映射工作原理示意图</div>
                            <div class="diagram-content">
                                <div style="display: flex; flex-direction: column; align-items: center; gap: 20px;">
                                    <div style="display: flex; align-items: center; gap: 30px;">
                                        <div style="text-align: center;">
                                            <div class="diagram-light-source">光源</div>
                                            <div>光源视角</div>
                                        </div>
                                        <svg width="50" height="20">
                                            <line x1="0" y1="10" x2="50" y2="10" stroke="#60a5fa" stroke-width="2" stroke-dasharray="5,5"/>
                                            <polygon points="50,5 60,10 50,15" fill="#60a5fa"/>
                                        </svg>
                                        <div style="text-align: center;">
                                            <div class="diagram-shadow-map">阴影贴图</div>
                                            <div>深度纹理</div>
                                        </div>
                                    </div>
                                    <div style="color: #94a3b8; max-width: 600px;">
                                        从光源视角渲染场景深度信息，生成阴影贴图。然后在正常渲染时，通过比较当前像素在光源空间的深度与阴影贴图中的深度值来判断阴影。
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </details>
                
                <details>
                    <summary>1.2 数学原理与坐标变换</summary>
                    <div>
                        <p>阴影映射的数学基础建立在坐标变换和深度比较之上：</p>
                        
                        <div class="code-block">
                            <span class="code-comment">// 世界空间到光源空间的变换</span><br>
                            ShadowCoord = LightVP * WorldMatrix * Position<br><br>
                            
                            <span class="code-comment">// 透视除法与纹理坐标映射</span><br>
                            shadowDepth = shadowCoord.z / shadowCoord.w<br>
                            uv = (shadowCoord.xy / shadowCoord.w) / 2.0 + 0.5<br><br>
                            
                            <span class="code-comment">// 深度比较（核心阴影测试）</span><br>
                            if (shadowDepth > shadowMapDepth + bias)<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;pixelColor = shadowColor; <span class="code-comment">// 该点处于阴影</span>
                        </div>
                    </div>
                </details>
                
                <details>
                    <summary>1.3 核心算法步骤详解</summary>
                    <div>
                        <p>阴影映射算法的完整实现包含多个精心设计的步骤：</p>
                        
                        <div class="algorithm-box">
                            <div class="algorithm-title">
                                <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/></svg>
                                关键实现步骤
                            </div>
                            <ol>
                                <li><strong>阴影贴图初始化</strong>：创建深度纹理并设置参数</li>
                                <li><strong>阴影生成Pass</strong>：从光源视角渲染场景深度</li>
                                <li><strong>场景渲染Pass</strong>：从摄像机视角渲染并进行阴影测试</li>
                            </ol>
                        </div>
                        
                        <div class="code-block">
                            <span class="code-comment">// 阴影计算核心代码（GLSL片元着色器）</span><br>
                            <span class="code-keyword">float</span> <span class="code-function">ShadowCalculation</span>(vec4 fragPosLightSpace) {<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-comment">// 执行透视除法</span><br>
                            &nbsp;&nbsp;&nbsp;&nbsp;vec3 projCoords = fragPosLightSpace.xyz / fragPosLightSpace.w;<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-comment">// 转换到[0,1]范围</span><br>
                            &nbsp;&nbsp;&nbsp;&nbsp;projCoords = projCoords * 0.5 + 0.5;<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-comment">// 深度比较</span><br>
                            &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">float</span> closestDepth = <span class="code-function">texture</span>(shadowMap, projCoords.xy).r;<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">float</span> currentDepth = projCoords.z;<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-comment">// 阴影偏置（避免z-fighting）</span><br>
                            &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">float</span> bias = <span class="code-function">max</span>(0.05 * (1.0 - <span class="code-function">dot</span>(normal, lightDir)), 0.005);<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">float</span> shadow = currentDepth > closestDepth + bias ? 1.0 : 0.0;<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">return</span> shadow;<br>
                            }
                        </div>
                    </div>
                </details>
                
                <details>
                    <summary>1.4 算法变体与演进</summary>
                    <div>
                        <p>阴影映射技术已经发展出多个重要变体：</p>
                        
                        <div class="optimization-grid">
                            <div class="optimization-card">
                                <h4>
                                    <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/></svg>
                                    百分比接近过滤（PCF）
                                </h4>
                                <p>解决阴影锯齿问题，通过多重采样平均结果来模拟半影效果，让阴影边缘更加平滑。</p>
                            </div>
                            
                            <div class="optimization-card">
                                <h4>
                                    <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/></svg>
                                    百分比接近软阴影（PCSS）
                                </h4>
                                <p>在PCF基础上引入"光源大小"参数，动态调整过滤核大小，模拟真实的软阴影效果。</p>
                            </div>
                            
                            <div class="optimization-card">
                                <h4>
                                    <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/></svg>
                                    方差阴影映射（VSM）
                                </h4>
                                <p>存储深度和深度平方，使用切比雪夫不等式估计遮挡概率，支持线性过滤和硬件加速。</p>
                            </div>
                        </div>
                    </div>
                </details>
            </section>
            
            <section class="chapter">
                <h2>二、平行光和点光源阴影的实现细节与代码示例</h2>
                <p>平行光和点光源阴影映射在技术实现上存在显著差异，直接影响性能、内存使用和视觉效果。</p>
                
                <details open>
                    <summary>2.1 平行光阴影映射的实现流程</summary>
                    <div>
                        <p>平行光阴影映射主要用于模拟太阳光等远距离光源的效果，使用正交投影矩阵：</p>
                        
                        <div class="code-block">
                            <span class="code-comment">// 正交投影矩阵构建（平行光）</span><br>
                            glm::mat4 lightProjection = <span class="code-function">glm::ortho</span>(-10.0f, 10.0f, -10.0f, 10.0f, near_plane, far_plane);
                        </div>
                        
                        <div class="diagram">
                            <div class="diagram-title">平行光阴影映射特点</div>
                            <div class="diagram-content">
                                <div style="text-align: left; max-width: 800px;">
                                    <ul>
                                        <li><strong>投影类型</strong>：正交投影（所有光线平行）</li>
                                        <li><strong>视锥体</strong>：长方体形状</li>
                                        <li><strong>深度存储</strong>：Z深度值（线性关系）</li>
                                        <li><strong>渲染次数</strong>：1次渲染pass</li>
                                        <li><strong>适用场景</strong>：太阳光、远距离光源、户外场景</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </details>
                
                <details>
                    <summary>2.2 点光源阴影映射（立方体映射）的实现</summary>
                    <div>
                        <p>点光源阴影映射使用立方体映射（Cube Map）技术来捕获所有方向的深度信息：</p>
                        
                        <div class="code-block">
                            <span class="code-comment">// 创建立方体深度纹理</span><br>
                            glGenTextures(1, &depthCubeMap);<br>
                            glBindTexture(GL_TEXTURE_CUBE_MAP, depthCubeMap);<br><br>
                            
                            <span class="code-comment">// 为立方体的六个面分配存储</span><br>
                            for (unsigned int i = 0; i < 6; ++i) {<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;glTexImage2D(GL_TEXTURE_CUBE_MAP_POSITIVE_X + i, 0, GL_DEPTH_COMPONENT,<br>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SHADOW_WIDTH, SHADOW_HEIGHT, 0, GL_DEPTH_COMPONENT, GL_FLOAT, NULL);<br>
                            }
                        </div>
                        
                        <div class="diagram">
                            <div class="diagram-title">点光源阴影映射特点</div>
                            <div class="diagram-content">
                                <div style="text-align: left; max-width: 800px;">
                                    <ul>
                                        <li><strong>投影类型</strong>：透视投影（光线从一点发散）</li>
                                        <li><strong>视锥体</strong>：6个截头圆锥体（立方体的六个面）</li>
                                        <li><strong>深度存储</strong>：平方距离（避免开方运算）</li>
                                        <li><strong>渲染次数</strong>：6次渲染pass（每个面一次）</li>
                                        <li><strong>适用场景</strong>：灯泡、火炬、局部光源、室内场景</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </details>
                
                <details>
                    <summary>2.4 关键技术差异对比</summary>
                    <div>
                        <p>平行光和点光源阴影映射在技术实现上的核心差异：</p>
                        
                        <table class="comparison-table">
                            <thead>
                                <tr>
                                    <th>对比维度</th>
                                    <th class="parallel">平行光阴影映射</th>
                                    <th class="point">点光源阴影映射</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>投影类型</strong></td>
                                    <td class="parallel">正交投影（光线平行）</td>
                                    <td class="point">透视投影（光线发散）</td>
                                </tr>
                                <tr>
                                    <td><strong>视锥体</strong></td>
                                    <td class="parallel">长方体</td>
                                    <td class="point">6个截头圆锥体</td>
                                </tr>
                                <tr>
                                    <td><strong>深度存储</strong></td>
                                    <td class="parallel">Z深度值</td>
                                    <td class="point">平方距离</td>
                                </tr>
                                <tr>
                                    <td><strong>纹理类型</strong></td>
                                    <td class="parallel">2D纹理</td>
                                    <td class="point">立方体纹理（6个2D纹理）</td>
                                </tr>
                                <tr>
                                    <td><strong>渲染次数</strong></td>
                                    <td class="parallel">1次渲染pass</td>
                                    <td class="point">6次渲染pass</td>
                                </tr>
                                <tr>
                                    <td><strong>内存占用</strong></td>
                                    <td class="parallel">较低（1张纹理）</td>
                                    <td class="point">较高（6张纹理）</td>
                                </tr>
                                <tr>
                                    <td><strong>性能开销</strong></td>
                                    <td class="parallel">较低</td>
                                    <td class="point">较高（约6倍）</td>
                                </tr>
                                <tr>
                                    <td><strong>适用场景</strong></td>
                                    <td class="parallel">太阳光、户外场景</td>
                                    <td class="point">灯泡、室内场景</td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <div class="algorithm-box">
                            <div class="algorithm-title">
                                <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/></svg>
                                内存占用对比示例（2048×2048分辨率）
                            </div>
                            <ul>
                                <li><strong>平行光阴影贴图</strong>：1张2D纹理，占用约8MB内存</li>
                                <li><strong>点光源阴影贴图</strong>：6张2D纹理（立方体），占用约48MB内存</li>
                            </ul>
                            <p>这个差异对于内存受限的平台（如移动设备）来说非常重要。</p>
                        </div>
                    </div>
                </details>
            </section>
            
            <section class="chapter">
                <h2>三、阴影映射技术的优化方法与改进技术</h2>
                <p>阴影质量优化是阴影映射技术发展的核心驱动力，主要解决阴影锯齿、自阴影失真和软阴影生成等关键问题。</p>
                
                <details>
                    <summary>3.1 阴影质量优化算法</summary>
                    <div>
                        <p>主要优化算法对比：</p>
                        
                        <div class="optimization-grid">
                            <div class="optimization-card">
                                <h4>
                                    <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/></svg>
                                    PCF（百分比接近过滤）
                                </h4>
                                <p>解决阴影锯齿问题，通过多重采样平均结果。简单有效，但计算成本随采样次数增加。</p>
                            </div>
                            
                            <div class="optimization-card">
                                <h4>
                                    <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/></svg>
                                    PCSS（百分比接近软阴影）
                                </h4>
                                <p>动态计算过滤核大小，使其与光源尺寸和遮挡物距离相匹配，生成更真实的软阴影。</p>
                            </div>
                            
                            <div class="optimization-card">
                                <h4>
                                    <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/></svg>
                                    VSM（方差阴影映射）
                                </h4>
                                <p>存储深度和深度平方，使用切比雪夫不等式估计遮挡概率，支持硬件加速的线性过滤。</p>
                            </div>
                        </div>
                        
                        <div class="algorithm-box">
                            <div class="algorithm-title">
                                <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/></svg>
                                VSM核心优势
                            </div>
                            <ul>
                                <li><strong>常数时间复杂度</strong>：使用切比雪夫不等式快速估计遮挡概率</li>
                                <li><strong>支持线性过滤</strong>：可以使用mipmap、各向异性过滤和求和面积表</li>
                                <li><strong>优雅的深度偏置</strong>：通过方差自动处理不同斜率表面的偏置需求</li>
                                <li><strong>主要缺点</strong>：可能产生光渗（light bleeding）现象</li>
                            </ul>
                        </div>
                    </div>
                </details>
                
                <details>
                    <summary>3.2 阴影贴图分辨率优化</summary>
                    <div>
                        <p>阴影贴图分辨率优化的核心目标是在有限的内存预算下提供最佳的阴影质量：</p>
                        
                        <div class="algorithm-box">
                            <div class="algorithm-title">
                                <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/></svg>
                                级联阴影映射（CSM）
                            </div>
                            <p>将摄像机视锥体沿深度方向划分为多个区间（级联），每个区间使用独立的阴影贴图：</p>
                            <ul>
                                <li><strong>近处</strong>：使用高分辨率阴影贴图</li>
                                <li><strong>远处</strong>：使用低分辨率阴影贴图</li>
                                <li><strong>优势</strong>：有效提升整体采样效率，解决透视走样问题</li>
                            </ul>
                        </div>
                        
                        <div class="algorithm-box">
                            <div class="algorithm-title">
                                <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/></svg>
                                虚拟阴影映射（VSM）
                            </div>
                            <p>虚幻引擎5的虚拟阴影映射技术：</p>
                            <ul>
                                <li><strong>虚拟分辨率</strong>：16k×16k像素</li>
                                <li><strong>瓦片化管理</strong>：将阴影贴图分割成128×128像素的瓦片</li>
                                <li><strong>按需分配</strong>：只在需要时分配和渲染这些瓦片</li>
                                <li><strong>帧间缓存</strong>：瓦片在帧间缓存，除非被移动的物体或光源使失效</li>
                            </ul>
                        </div>
                    </div>
                </details>
                
                <details>
                    <summary>3.5 现代改进技术</summary>
                    <div>
                        <p>阴影映射技术在近年来出现了多项重要的技术突破：</p>
                        
                        <div class="optimization-grid">
                            <div class="optimization-card">
                                <h4>
                                    <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/></svg>
                                    深度学习超分辨率
                                </h4>
                                <p>NVIDIA的DLSS技术通过AI模型提升阴影质量，增强时间稳定性，减少重影现象，保留更多细节。</p>
                            </div>
                            
                            <div class="optimization-card">
                                <h4>
                                    <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/></svg>
                                    光线追踪阴影
                                </h4>
                                <p>通过多光线采样、接触硬化、全局细节一致等手段，营造出更逼真的阴影效果，避免传统阴影映射的走样问题。</p>
                            </div>
                            
                            <div class="optimization-card">
                                <h4>
                                    <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/></svg>
                                    实时重要性深度阴影映射
                                </h4>
                                <p>根据从当前摄像机视口捕获的重要性自适应分布深度阴影样本，在不影响视觉质量的前提下提高效率。</p>
                            </div>
                        </div>
                    </div>
                </details>
            </section>
            
            <section class="chapter">
                <h2>四、阴影映射技术的应用场景与实际案例</h2>
                <p>阴影映射技术已经渗透到游戏开发、建筑设计、工业仿真、虚拟现实等各个方面。</p>
                
                <details>
                    <summary>4.1 游戏开发中的应用</summary>
                    <div>
                        <p>阴影映射技术在游戏开发中占据着核心地位：</p>
                        
                        <div class="algorithm-box">
                            <div class="algorithm-title">
                                <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
                                AAA级游戏的技术应用
                            </div>
                            <ul>
                                <li><strong>《GTA5》</strong>：使用级联阴影映射（CSM）技术实现远近不同的阴影质量控制</li>
                                <li><strong>《原神》</strong>：采用8级级联阴影，前4级每帧更新，后4级分帧更新</li>
                                <li><strong>《使命召唤：现代战争》</strong>：大量运用基于光线追踪的阴影算法</li>
                                <li><strong>《堡垒之夜》第4章</strong>：使用虚拟阴影映射技术，统一多种阴影技术为单一集成通道</li>
                            </ul>
                        </div>
                    </div>
                </details>
                
                <details>
                    <summary>4.3 建筑可视化与工业设计应用</summary>
                    <div>
                        <p>阴影映射技术在建筑和工业设计领域发挥着越来越重要的作用：</p>
                        
                        <div class="algorithm-box">
                            <div class="algorithm-title">
                                <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/></svg>
                                建筑设计的阴影分析
                            </div>
                            <p>Shadowmap Studio是专门为建筑师设计的解决方案：</p>
                            <ul>
                                <li>实时的太阳光预测和精确的阴影分析</li>
                                <li>全球3D数据支持，即时查看建筑设计在环境中的效果</li>
                                <li>交互式的太阳能辐射评估和阴影分析</li>
                                <li>BIPV（建筑一体化光伏）设计支持</li>
                            </ul>
                        </div>
                        
                        <div class="algorithm-box">
                            <div class="algorithm-title">
                                <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/></svg>
                                光伏系统设计优化
                            </div>
                            <p>云端地球提供实景三维光伏设计技术方案：</p>
                            <ul>
                                <li>在线三维建模</li>
                                <li>建筑物阴影分析</li>
                                <li>光伏板可视化排布设计</li>
                                <li>多端展示汇报</li>
                            </ul>
                            <p>通过这项技术，传统的光伏设计流程被简化，项目的整体效率提高了近50%。</p>
                        </div>
                    </div>
                </details>
            </section>
            
            <section class="chapter">
                <h2>五、平行光和点光源阴影映射技术性能对比分析</h2>
                <p>理解不同阴影映射技术的性能差异对于做出正确的技术选择至关重要。</p>
                
                <details>
                    <summary>5.1 计算复杂度与渲染成本对比</summary>
                    <div>
                        <p>平行光和点光源阴影映射在计算复杂度上存在显著差异：</p>
                        
                        <table class="comparison-table">
                            <thead>
                                <tr>
                                    <th>对比维度</th>
                                    <th class="parallel">平行光阴影映射</th>
                                    <th class="point">点光源阴影映射</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>渲染次数</strong></td>
                                    <td class="parallel">1次渲染pass</td>
                                    <td class="point">6次渲染pass（立方体6个面）</td>
                                </tr>
                                <tr>
                                    <td><strong>GPU负载</strong></td>
                                    <td class="parallel">较低</td>
                                    <td class="point">较高（约6倍）</td>
                                </tr>
                                <tr>
                                    <td><strong>投影矩阵计算</strong></td>
                                    <td class="parallel">正交投影，简单线性运算</td>
                                    <td class="point">透视投影，涉及除法运算</td>
                                </tr>
                                <tr>
                                    <td><strong>片元着色器复杂度</strong></td>
                                    <td class="parallel">2D纹理采样，深度比较</td>
                                    <td class="point">立方体纹理采样，距离计算</td>
                                </tr>
                                <tr>
                                    <td><strong>软阴影计算成本</strong></td>
                                    <td class="parallel">2D多重采样</td>
                                    <td class="point">立方体六面多重采样（成本高6-12倍）</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </details>
                
                <details>
                    <summary>5.4 适用场景与选择策略</summary>
                    <div>
                        <p>不同阴影映射技术的适用场景和选择策略：</p>
                        
                        <div class="algorithm-box">
                            <div class="algorithm-title">
                                <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
                                平行光阴影映射的适用场景
                            </div>
                            <ul>
                                <li><strong>户外场景</strong>：模拟太阳光、月光等远距离光源</li>
                                <li><strong>大场景渲染</strong>：开放世界游戏、建筑漫游等</li>
                                <li><strong>性能敏感应用</strong>：需要高帧率的游戏或应用</li>
                                <li><strong>移动平台</strong>：受限于内存和计算能力的设备</li>
                            </ul>
                        </div>
                        
                        <div class="algorithm-box">
                            <div class="algorithm-title">
                                <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
                                点光源阴影映射的适用场景
                            </div>
                            <ul>
                                <li><strong>室内场景</strong>：模拟灯泡、火炬等局部光源</li>
                                <li><strong>需要真实反射的场景</strong>：点光源是实现真实反射的基础</li>
                                <li><strong>特殊效果</strong>：爆炸、魔法效果等</li>
                                <li><strong>高精度要求</strong>：需要精确的全方向阴影效果</li>
                            </ul>
                        </div>
                        
                        <div class="algorithm-box">
                            <div class="algorithm-title">
                                <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/></svg>
                                技术选择的决策因素
                            </div>
                            <ul>
                                <li><strong>视觉质量要求</strong>：简单场景用平行光，复杂室内用点光源</li>
                                <li><strong>性能预算</strong>：高帧率要求优先选择平行光</li>
                                <li><strong>内存限制</strong>：显存有限避免使用高分辨率点光源阴影</li>
                                <li><strong>开发复杂度</strong>：快速原型开发用平行光，复杂光照系统用点光源</li>
                            </ul>
                        </div>
                    </div>
                </details>
                
                <details>
                    <summary>5.5 性能优化建议与最佳实践</summary>
                    <div>
                        <p>基于性能对比分析，总结的优化建议和最佳实践：</p>
                        
                        <div class="optimization-grid">
                            <div class="optimization-card">
                                <h4>
                                    <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
                                    平行光优化策略
                                </h4>
                                <ul style="padding-left: 20px;">
                                    <li>使用级联阴影映射（2-4级）</li>
                                    <li>优化阴影距离，超出距离不渲染阴影</li>
                                    <li>选择合适的分辨率（移动端1024×1024，PC端2048×2048）</li>
                                    <li>使用斜率比例深度偏置</li>
                                </ul>
                            </div>
                            
                            <div class="optimization-card">
                                <h4>
                                    <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
                                    点光源优化策略
                                </h4>
                                <ul style="padding-left: 20px;">
                                    <li>限制点光源数量</li>
                                    <li>使用LOD技术：近距离用完整立方体映射，远距离用简化算法</li>
                                    <li>共享阴影贴图（多个相似点光源共享）</li>
                                    <li>优化采样策略，使用硬件PCF支持</li>
                                </ul>
                            </div>
                            
                            <div class="optimization-card">
                                <h4>
                                    <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
                                    通用优化建议
                                </h4>
                                <ul style="padding-left: 20px;">
                                    <li>预计算静态场景阴影</li>
                                    <li>使用屏幕空间技术补充</li>
                                    <li>延迟渲染管线中只对可见像素计算阴影</li>
                                    <li>利用硬件特性（MSAA、各向异性过滤）</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </details>
            </section>
            
            <section class="chapter">
                <h2>结语</h2>
                <p>阴影映射技术作为计算机图形学中生成实时阴影的核心算法，从1978年Lance Williams的开创性工作发展至今，已经成为现代实时渲染不可或缺的基础技术。</p>
                
                <div class="algorithm-box">
                    <div class="algorithm-title">
                        <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
                        技术演进与展望
                    </div>
                    <p>从基础的硬阴影到PCF、PCSS、VSM等软阴影技术，阴影映射在保持核心原理不变的同时，不断吸收新的算法思想。随着光线追踪硬件的普及、机器学习技术的引入以及实时全局光照算法的成熟，阴影映射将在保持其基础地位的同时，不断吸收新的技术元素。</p>
                    <p>对于开发者而言，掌握阴影映射技术不仅是图形编程的基础要求，更是创造高质量视觉效果的必备技能。通过深入理解技术原理、熟练掌握实现方法、灵活运用优化策略，开发者能够在不同的应用场景中选择和实现最适合的阴影解决方案。</p>
                </div>
            </section>
        </div>
        
        <footer>
            <p>阴影映射技术（Shadow Mapping）详解 - 计算机图形学核心算法</p>
            <p>本文全面剖析了阴影映射技术从基础原理到现代应用的完整知识体系</p>
            <div class="ai-generated">
                <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
                内容基于阴影映射技术资料整理生成
            </div>
        </footer>
    </div>
</body>
</html>